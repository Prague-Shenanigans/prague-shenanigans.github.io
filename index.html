<!DOCTYPE html>
<html lang="en" x-data="{ section: 'map' }"
  class="scroll-smooth bg-[var(--color-bg-base)] text-[var(--color-text-base)]">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prague Shenanigans</title>
    <link rel="icon" type="image/png" href="assets/logo/favicon.png">

    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="assets/css/theme.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  </head>

  <body x-cloak x-data="router()" x-init="init()">

    <header
      class="fixed top-0 left-0 w-full z-50 px-4 sm:px-8 py-2 bg-[var(--color-bg-base)] text-[var(--color-primary)] shadow-md"
      x-data="{ menuOpen: false }">

      <div
        class="relative max-w-screen-xl mx-auto w-full flex items-center justify-between">

        <!-- Logo (left) -->
        <div class="flex-shrink-0">
          <img src="assets/logo/web_logo.png" alt="Logo"
            class="h-14 sm:h-15 w-auto" />
        </div>

        <!-- Hamburger Button (mobile) -->
        <button class="sm:hidden focus:outline-none"
          @click="menuOpen = !menuOpen">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

        <!-- Navigation (desktop) -->
        <nav class="hidden sm:flex space-x-6">
          <button @click="navigate('mission')"
                  :class="{ 'active-nav': active === 'mission' }"
                  class="nav-button">Mission</button>
        
          <button @click="navigate('map')"
                  :class="{ 'active-nav': active === 'map' }"
                  class="nav-button">Explore</button>
        
          <button @click="navigate('podcasts')"
                  :class="{ 'active-nav': active === 'podcasts' }"
                  class="nav-button">Meet the People</button>
        </nav>
        
      </div>

      <!-- Mobile Navigation (dropdown) -->
      <div class="sm:hidden mt-3 px-2 space-y-2" x-show="menuOpen" x-transition>
        <button @click="navigate('mission'); menuOpen = false"
                :class="{ 'active-nav': active === 'mission' }"
                class="w-full text-left nav-button">Mission</button>
      
        <button @click="navigate('map'); menuOpen = false"
                :class="{ 'active-nav': active === 'map' }"
                class="w-full text-left nav-button">Map</button>
      
        <button @click="navigate('podcasts'); menuOpen = false"
                :class="{ 'active-nav': active === 'podcasts' }"
                class="w-full text-left nav-button">Podcasts</button>
      </div>
      
    </header>

    <!-- Main Content Container -->
    <main id="main-content" class="pt-32 px-6 max-w-4xl mx-auto fade"
      hx-get="pages/map.html" hx-trigger="load" hx-swap="innerHTML settle:0.5s">
    </main>

    <script>
      
      document.body.addEventListener('htmx:afterSwap', function(evt) {
        const target = document.querySelector('#main-content');
        // Trigger fade-in on the new .fade content
        const fadeSection = target.querySelector('.fade');
        if (fadeSection) {
          fadeSection.classList.add('htmx-added');
        }
      });

      function podcastList() {
        const state = {
          podcasts: [],
            async load() {
            const response = await fetch('podcasts.json');
            this.podcasts = await response.json();
        }
        };
        return state;
      }

      function router() {
        return {
          active: 'map',
          routes: {
            'mission': 'pages/mission.html',
            'map': 'pages/map.html',
            'podcasts': 'pages/podcasts.html'
          },
    
          init() {
            window.addEventListener('hashchange', this.route.bind(this));
            this.route(); // Load initial route
          },
    
          route() {
            const hash = window.location.hash.replace('#/', '') || 'map';
            this.active = hash;
    
            if (this.routes[hash]) {
              document.getElementById('main-content').setAttribute('hx-get', this.routes[hash]);
              document.getElementById('main-content').removeAttribute('hx-trigger'); // ensure fresh reload
              htmx.process(document.getElementById('main-content'));
              htmx.ajax('GET', this.routes[hash], '#main-content');
            }
          },
    
          navigate(target) {
            window.location.hash = `#/${target}`;
          }
        }
      }

    </script>
    

  </body>

</html>
